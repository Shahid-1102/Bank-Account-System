<!-- Path: src/app/admin/customer-details/customer-details.html -->
<div class="container-fluid">
  <div class="d-flex align-items-center my-4">
    <a mat-icon-button routerLink="/admin/dashboard" title="Back to Dashboard"><mat-icon>arrow_back</mat-icon></a>
    <h1 class="ms-2 mb-0">Customer Account Details</h1>
  </div>

  <div *ngIf="isLoading" class="text-center p-5"><mat-spinner></mat-spinner></div>
  <div *ngIf="!isLoading && accounts.length === 0"><mat-card><mat-card-content><p>This customer has no accounts.</p></mat-card-content></mat-card></div>

  <div *ngIf="!isLoading" class="row">
    <div *ngFor="let account of accounts" class="col-lg-6 col-md-12 mb-4">
      <mat-card>
        <mat-card-header>
          <mat-card-title>{{ account.accountType }} Account</mat-card-title>
          <mat-card-subtitle><span class="badge" [ngClass]="{
            'bg-warning text-dark': account.status === 'PENDING',
              'bg-success': account.status === 'APPROVED',
              'bg-danger': account.status === 'REJECTED'
          }">{{ account.status }}</span></mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <p><strong>Account Number:</strong> {{ account.accountNumber }}</p>
          <h4>{{ account.balance | currency:'INR' }}</h4>
        </mat-card-content>
        <mat-card-actions>
          <button mat-button color="primary" (click)="openHistoryModal(historyModal, account.accountNumber)">View Transactions</button>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>
</div>

<!-- Transaction History Modal -->
<ng-template #historyModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title">Transaction History for {{ selectedAccountForHistory }}</h4>
    <button type="button" class="btn-close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body position-relative">
    <div *ngIf="isLoadingHistory" class="loading-shade"><mat-spinner></mat-spinner></div>
    <table class="table table-sm table-striped">
      <thead><tr><th>Date</th><th>Description</th><th>Type</th><th>Amount</th><th>Balance After</th></tr></thead>
      <tbody>
        <tr *ngFor="let tx of historyData">
          <td>{{ tx.timestamp | date:'short' }}</td>
          <td>{{ tx.description }}</td>
          <td>{{ tx.transactionType }}</td>
          <td [ngClass]="tx.transactionType === 'DEPOSIT' ? 'text-success' : 'text-danger'">{{ tx.amount | currency:'INR' }}</td>
          <td>{{ tx.balanceAfter | currency:'INR' }}</td>
        </tr>
        <tr *ngIf="historyData.length === 0 && !isLoadingHistory">
          <td colspan="5" class="text-center p-4">No transactions found.</td>
        </tr>
      </tbody>
    </table>
    <!-- THIS IS THE NEW PAGINATOR -->
    <mat-paginator #historyPaginator [pageSizeOptions]="[5, 10, 25]" [pageSize]="10" [length]="historyTotalElements" showFirstLastButtons></mat-paginator>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-light" (click)="modal.dismiss()">Close</button>
  </div>
</ng-template>